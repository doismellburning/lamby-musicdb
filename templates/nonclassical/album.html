{% extends "base.html" %}

{% load duration %}

{% block headtitle %}{{ album }} - {{ album.first_artist }} - {{ block.super }}{% endblock %}

{% block title %}{{ album }}{% endblock %}

{% block subtitle %}
  <a href="{{ artist.get_absolute_url }}">
    {{ artist.long_name }}
  </a>
{% endblock %}

{% block content %}

{% if album.cover %}
<p style="float: right">
  {% if request.user.is_authenticated %}
  <a href="{% url nonclassical-play-album album.id %}">
    <img src="{{ album.cover.url }}" alt="Play {{ album }}">
  </a>
  {% else %}
    <img src="{{ album.cover.url }}" alt="Play {{ album }}">
  {% endif %}
</p>
{% endif %}

<table>
{% with album.cds.count as album_cds_count %}
{% for cd in album.cds.all %}
<tr>
<td>
  {% ifnotequal album_cds_count 1 %}
    CD{{ forloop.counter }}
  {% endifnotequal %}

  <ol>
    {% for track in cd.tracks.select_related.all %}
      {% if request.user.is_authenticated %}
      <li><a href="{% url play-music-file track.music_file_id %}">{{ track }}</a> {{ track.music_file.length|duration }}</li>
      {% else %}
      <li>{{ track }} {{ track.music_file.length|duration }}</li>
      {% endif %}
    {% endfor %}
  </ol>

  {% ifnotequal album_cds_count 1 %}
    {% if request.user.is_authenticated %}
      <a href="{% url nonclassical-play-cd cd.id %}">Play</a>
    {% endif %}
    {{ cd.total_duration|duration }}
  {% endifnotequal %}
</td>
</tr>
{% endfor %}
{% endwith %}
</table>

{% if request.user.is_authenticated %}
<a href="{% url nonclassical-play-album album.id %}">Play album</a>
{% endif %}
({{ album.total_duration|duration }})

{% with album.previous as previous %}
{% with album.next as next %}
<br/>
<br/>
<table width="100%">
<tr>
  <td width="50%">
    {% if previous %}
     &laquo; <a href="{% url nonclassical-album artist.slug previous.slug %}">{{ previous }}</a>
    {% endif %}
  </td>
  <td width="50%" align="right">
    {% if next %}
     <a href="{% url nonclassical-album artist.slug next.slug %}">{{ next }}</a> &raquo;
    {% endif %}
  </td>
</tr>
</table>
{% endwith %}
{% endwith %}

{% endblock %}
